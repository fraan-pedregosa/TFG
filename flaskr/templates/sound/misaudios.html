{% extends 'base.html' %}

{% block title %}Audios{% endblock %}
{% block header %}{% endblock %}

{% block content %}
{% if g.user %}
<a class="action" href="{{ url_for('sound.create') }}">New</a>
{% endif %}
{% for sound in sound %}
{% if g.user['email'] == sound['email'] %}
<article class="post">
  <header>
    <div>
      <h2 class="tituloAudio">{{ sound['title'] }}</h2>
      <div class="about">by {{ sound['email'] }}</div>
      <div class="audio green-audio-player">
        <div class="play-pause-btn">
          <svg class="play-icon" viewBox="0 0 18 24" height="24" width="18" xmlns="http://www.w3.org/2000/svg">
            <path id="playPause{{ loop.index }}" class="play-pause-icon" d="M18 12L0 24V0" fill-rule="evenodd"
              fill="#566574"></path>
          </svg>
          <svg class="pause-icon" style="display: none;" viewBox="0 0 18 24" height="24" width="18"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M0 0h6v24H0zM12 0h6v24h-6z" fill-rule="evenodd" fill="#566574"></path>
          </svg>
        </div>

        <div class="controls">
          <span class="current-time">0:00</span>
          <div data-direction="horizontal" class="slider">
            <div class="progress">
              <div data-method="rewind" id="progress-pin{{ loop.index }}" class="pin"></div>
            </div>
          </div>
          <span class="total-time">0:{{ sound['duration'] }}</span>
        </div>

        <div class="volume">
          <div class="volume-btn">
            <svg viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path id="speaker"
                d="M14.667 0v2.747c3.853 1.146 6.666 4.72 6.666 8.946 0 4.227-2.813 7.787-6.666 8.934v2.76C20 22.173 24 17.4 24 11.693 24 5.987 20 1.213 14.667 0zM18 11.693c0-2.36-1.333-4.386-3.333-5.373v10.707c2-.947 3.333-2.987 3.333-5.334zm-18-4v8h5.333L12 22.36V1.027L5.333 7.693H0z"
                fill-rule="evenodd" fill="#566574"></path>
            </svg>
          </div>
          <div class="volume-controls hidden">
            <div data-direction="vertical" class="slider">
              <div class="progress">
                <div data-method="changeVolume" id="volume-pin{{ loop.index }}" class="pin"></div>
              </div>
            </div>
          </div>
        </div>

        <audio src="{{ url_for('static', filename='audios/' + sound['path']) }}" crossorigin=""></audio>

      </div>
      <div class="prompt">{{sound['prompt']}}</div>
      <div class="prompt">{{sound['path']}}</div>

    </div>
    <a class="action" href="{{ url_for('sound.update', sound_id=sound['_id']) }}">Edit</a>

  </header>
</article>
{% endif %}
{% if not loop.last %}
{% endif %}
{% endfor %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Selecciona todos los elementos de clase 'green-audio-player'
  const players = document.querySelectorAll('.green-audio-player');

  // Itera sobre cada elemento y agrega el evento 'click' al botón de reproducción
  players.forEach(function (player) {
    const audio = player.querySelector('audio');
    const playPauseBtn = player.querySelector('.play-pause-btn');
    const currentTimeDisplay = player.querySelector('.current-time');

    // Agrega un evento 'click' al botón de reproducción
    playPauseBtn.addEventListener('click', function () {
      const playIcon = playPauseBtn.querySelector('.play-icon');
      const pauseIcon = playPauseBtn.querySelector('.pause-icon');
      if (audio.paused) {
        audio.play(); // Si el audio está pausado, reproducelo
        playIcon.style.display = 'none'; // Oculta el icono de reproducción
        pauseIcon.style.display = ''; // Muestra el icono de pausa
      } else {
        audio.pause(); // Si el audio está reproduciendo, pausalo
        playIcon.style.display = ''; // Muestra el icono de reproducción
        pauseIcon.style.display = 'none'; // Oculta el icono de pausa
      }
    });

    // Agrega un evento 'timeupdate' al audio
    audio.addEventListener('timeupdate', function () {
      // Actualiza el tiempo actual
      const minutes = Math.floor(audio.currentTime / 60);
      const seconds = Math.floor(audio.currentTime % 60);
      currentTimeDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    });

    // Agrega un evento 'ended' al audio
    audio.addEventListener('ended', function () {
      // Restablece el tiempo de reproducción
      currentTimeDisplay.textContent = '0:00';
      // Muestra el icono de reproducción
      playPauseBtn.querySelector('.play-icon').style.display = '';
      // Oculta el icono de pausa
      playPauseBtn.querySelector('.pause-icon').style.display = 'none';
    });
  });
});
</script>

{% endblock %}